-- Simplified Hotel Management System - Only 3 Tables
-- Much easier to explain in interviews!

CREATE DATABASE IF NOT EXISTS hotel_management;
USE hotel_management;

-- Table 1: ROOMS - All room information in one place
CREATE TABLE rooms (
    room_id INT PRIMARY KEY AUTO_INCREMENT,
    room_number VARCHAR(10) NOT NULL UNIQUE,
    room_type VARCHAR(50) NOT NULL,           -- Single, Double, Deluxe, Suite
    price DECIMAL(10, 2) NOT NULL,            -- Price per night
    floor_number INT,
    capacity INT NOT NULL,                     -- Number of guests
    status VARCHAR(20) DEFAULT 'AVAILABLE',    -- AVAILABLE, OCCUPIED, MAINTENANCE
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Table 2: BOOKINGS - Guest info + booking info combined
CREATE TABLE bookings (
    booking_id INT PRIMARY KEY AUTO_INCREMENT,
    
    -- Guest Information (no separate guests table)
    guest_name VARCHAR(100) NOT NULL,
    guest_email VARCHAR(100),
    guest_phone VARCHAR(15) NOT NULL,
    guest_id_proof VARCHAR(50) NOT NULL,
    
    -- Booking Information
    room_id INT NOT NULL,
    room_number VARCHAR(10) NOT NULL,
    check_in_date DATE NOT NULL,
    check_out_date DATE NOT NULL,
    num_guests INT NOT NULL,
    total_amount DECIMAL(10, 2) NOT NULL,
    
    -- Payment Information (no separate payments table)
    payment_method VARCHAR(20),                -- CASH, CARD, UPI, ONLINE
    payment_status VARCHAR(20) DEFAULT 'PENDING', -- PENDING, PAID, REFUNDED
    
    -- Status
    booking_status VARCHAR(20) DEFAULT 'CONFIRMED', -- CONFIRMED, CHECKED_IN, CHECKED_OUT, CANCELLED
    special_requests TEXT,
    booked_by VARCHAR(50),                     -- Staff username
    booking_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    
    FOREIGN KEY (room_id) REFERENCES rooms(room_id)
);

-- Table 3: STAFF - User accounts only
CREATE TABLE staff (
    staff_id INT PRIMARY KEY AUTO_INCREMENT,
    username VARCHAR(50) NOT NULL UNIQUE,
    password VARCHAR(255) NOT NULL,
    full_name VARCHAR(100) NOT NULL,
    role VARCHAR(20) NOT NULL,                 -- ADMIN, RECEPTIONIST, MANAGER
    phone VARCHAR(15),
    status VARCHAR(20) DEFAULT 'ACTIVE',       -- ACTIVE, INACTIVE
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Insert sample rooms (no room_types table needed)
INSERT INTO rooms (room_number, room_type, price, capacity, floor_number) VALUES
('101', 'Single', 1500.00, 1, 1),
('102', 'Single', 1500.00, 1, 1),
('103', 'Single', 1500.00, 1, 1),
('201', 'Double', 2500.00, 2, 2),
('202', 'Double', 2500.00, 2, 2),
('203', 'Double', 2500.00, 2, 2),
('301', 'Deluxe', 4000.00, 3, 3),
('302', 'Deluxe', 4000.00, 3, 3),
('401', 'Suite', 6000.00, 4, 4),
('402', 'Suite', 6000.00, 4, 4);

-- Insert default staff
INSERT INTO staff (username, password, full_name, role, phone) VALUES
('admin', 'admin123', 'System Administrator', 'ADMIN', '9876543210'),
('reception', 'reception123', 'Reception Desk', 'RECEPTIONIST', '9876543211');

-- Simple view for occupancy
CREATE VIEW room_occupancy AS
SELECT 
    room_type,
    COUNT(*) AS total_rooms,
    SUM(CASE WHEN status = 'OCCUPIED' THEN 1 ELSE 0 END) AS occupied_rooms,
    SUM(CASE WHEN status = 'AVAILABLE' THEN 1 ELSE 0 END) AS available_rooms
FROM rooms
GROUP BY room_type;
